# 第一节：异步开发相关概念

## 一、相关概念解释
### 1. 并发
并发是指在**同一时间段**内，有多个任务都在执行，但在任意时刻，只有一个任务在执行，即这些任务是交替执行的。例如，在多线程环境下，线程的切换是由操作系统来控制的，每个线程轮流获取CPU的执行时间，创建出并发执行的效果。并发可以在单核CPU上实现，也可以在多核CPU上实现。

### 2. 并行
并行是指在**同一时刻**，有多个任务同时在进行。例如，在多核CPU环境下，每个核心可以在同一时间运行一个任务，从而实现多个任务的并行处理。并行需要在多核（或者说多处理器）CPU上实现，因为在单核CPU上，任意时刻只能执行一个任务。

### 3. 阻塞
阻塞是指在程序等待某个操作完成（通常指的就是I/O操作）期间，自身无法继续执行的状态。在阻塞状态时，程序无法进行其他任务，只能等待，直到阻塞的操作完成。

### 4. 非阻塞
非阻塞是指在程序执行某个操作时（通常指的就是I/O操作），不需要等待该操作完成，可以继续执行其他任务。这样就可以提高程序的执行效率，避免因等待某个操作而浪费CPU的时间。

### 5. 同步
同步是指在程序执行一个操作（如 I/O 操作）后，必须等待该操作完成后，才能继续执行下一步操作。这与阻塞有一定的相似性，但是，阻塞是指程序在等待某个操作（如 I/O 操作）完成的过程中，自身无法继续执行，而同步只是要求操作按照某种预定的顺序一步一步地执行。同步不一定是阻塞的。

### 6. 异步
异步是指程序在执行一个操作（如 I/O 操作）后，不需要等待该操作完成，就可以继续执行其他操作。与非阻塞相比，非阻塞主要体现在单个操作上，当该操作无法立即得到结果时，不会阻塞程序的执行，而异步则是在程序设计层面，当一个异步过程启动后，程序可以在未得到结果时继续执行其他操作，异步过程在完成后，通过状态、通知和回调来通知主程序。

## 二、异步开发的几种实现方式
实现异步开发，可以使用多进程、多线程和协程来实现。

### 1. 进程
进程是操作系统进行资源分配和调度的一个独立单位，每个进程都有自己的独立内存空间和系统资源。通过创建多个进程，各个进程可以同时执行不同的任务，实现并发编程。进程之间的运行互不影响，如果一个进程崩溃，不会影响其他进程的正常运行。但是，进程之间的切换和通信成本相对较高，每个进程需要占用独立的系统资源（如内存），因此对资源的消耗相对较大。在Python中，多进程适合处理CPU密集型的任务，比如视频转码、科学计算等。

### 2. 线程
线程是进程内的一个执行单元，是操作系统进行任务调度的基本单位。一个进程内通常包含多个线程，这些线程共享进程的资源，包括内存空间、文件句柄等。通过创建多个线程，一个进程内的多个任务可以同时执行，实现并发编程。与进程相比，线程之间切换的成本更低，且线程之间的通信更方便，因为它们共享同一份内存空间。但是，线程之间的运行互相影响，如果一个线程崩溃，可能会影响同一进程内的其他线程。另外，线程的并发执行需要操作系统的支持，不同的操作系统对线程的支持程度不同。Python中的线程有GIL锁，即在同一个进程中，同一时刻只能有一个线程在运行，即可以实现并发的操作。多线程适合处理I/O密集型的任务，比如网络请求、磁盘读写等。

## 三、协程
协程（Coroutine）是一种程序组件，通过它可以实现多任务的并发执行。与传统进程和线程相比，协程提供了更轻量级的并发编程解决方案。本文将介绍协程的概念、实现并发编程的方式以及与进程、线程相比的优势。

### 1. 协程的概念
协程是一种用户态的轻量级线程，它允许程序在**单个线程**内实现多个任务的并发执行。协程通过协作式多任务来实现，这意味着协程会主动交出控制权，让其他协程运行。与线程和进程不同，协程的切换不需要操作系统内核的介入，从而降低了开销。

### 2. 协程实现并发编程
协程实现并发编程的核心思想是利用函数的暂停和恢复。在协程中，函数可以在某个点暂停执行，并在适当的时候恢复执行，而不会影响其他协程的运行。这种机制使得多个协程可以在单个线程内交替执行，从而实现并发。

协程的实现通常依赖于以下两个关键概念：

1. **生成器（Generator）**：生成器是一种特殊的函数，可以在执行过程中多次暂停和恢复。通过生成器，我们可以实现简单的协程功能。例如，在Python中，使用`yield`关键字可以创建生成器。
2. **异步编程（Asynchronous Programming）**：异步编程是一种编程范式，允许程序在等待输入/输出操作完成时执行其他任务。在协程中，可以利用异步编程实现并发。例如，Python中的`async`和`await`关键字提供了异步编程的支持。

### 3. 协程与进程、线程的优势
1. **轻量级**：协程的创建和切换开销远低于线程和进程。由于协程在用户态执行，因此不需要内核态的上下文切换，从而降低了开销。
2. **高并发性能**：由于协程的轻量级特性，单个线程可以创建大量协程，实现高并发处理。相比之下，线程和进程的数量受到系统资源的限制。
3. **资源共享**：协程在单个线程内运行，可以轻松地共享资源，无需考虑线程或进程间的同步和通信问题。
4. **简化编程模型**：协程的协作式多任务特性使得并发编程更加直观和简单。开发者可以专注于业务逻辑，而不是线程或进程的同步和竞争条件。

## 四、同步和异步的web部署方式
1. WSGI：同步。通过多进程+多线程的方式来实现并发的。
2. ASGI：异步。通过多进程+主线程（不存在多线程）+协程的方式来实现并发的。但是在项目中，有可能是会使用多线程的。



> 原文: <https://www.yuque.com/hynever/async-django/hidp8tcscpvzwem4>